<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zidan Test - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            background-image: url('1.jpg');
            background-size: cover;
            background-attachment: fixed;
        }
        
        .overlay {
            background-color: rgba(255, 255, 255, 0.95);
            min-height: 100vh;
        }
        
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        
        .logo-icon {
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        
        nav ul li a:hover {
            background-color: var(--primary-color);
        }
        
        .nav-active {
            background-color: var(--primary-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .question-container {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: #f9f9f9;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .option-item input[type="radio"] {
            margin-left: 10px;
        }
        
        .option-item input[type="text"] {
            flex: 1;
            border: none;
            padding: 8px;
        }
        
        .option-item input[type="text"]:focus {
            outline: none;
        }
        
        .exams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .exam-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1.5rem;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .exam-card h3 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .exam-card p {
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .exam-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 1rem 0;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .header-container {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            .exams-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="overlay">
        <header>
            <div class="header-container">
                <div class="logo">
                    <span class="logo-icon">ğŸ“</span>
                    <h1>Zidan Test</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" id="nav-home" class="nav-active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li><a href="#" id="nav-exams">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</a></li>
                        <li><a href="#" id="nav-add-exam">Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù†</a></li>
                        <li><a href="#" id="nav-take-exam">Ø£Ø¯Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù†</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="container">
            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div id="home-section" class="section">
                <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Zidan Test</h2>
                <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</p>
                <div class="stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
                    <div class="stat-card" style="background: #e3f2fd; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3 id="exams-count">0</h3>
                        <p>Ø§Ù…ØªØ­Ø§Ù† Ù…ØªØ§Ø­</p>
                    </div>
                    <div class="stat-card" style="background: #e8f5e9; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3 id="questions-count">0</h3>
                        <p>Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯ -->
            <div id="add-exam-section" class="section" style="display: none;">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
                <div id="add-exam-alert"></div>
                <div class="form-group">
                    <label for="exam-name">Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                    <input type="text" id="exam-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                </div>
                <div class="form-group">
                    <label for="exam-duration">Ù…Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                    <input type="number" id="exam-duration" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†" value="30">
                </div>
                <div class="form-group">
                    <label for="exam-description">ÙˆØµÙ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                    <textarea id="exam-description" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†"></textarea>
                </div>
                
                <div id="questions-container">
                    <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                </div>
                
                <button class="btn btn-success" id="add-question-btn">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
                <button class="btn" id="save-exam-btn">Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
            </div>

            <!-- Ù‚Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª -->
            <div id="exams-section" class="section" style="display: none;">
                <h2>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                <div id="exams-alert"></div>
                <div id="exams-container" class="exams-grid">
                    <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª...</div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
            <div id="take-exam-section" class="section" style="display: none;">
                <h2>Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
                <div id="exam-selection">
                    <div class="form-group">
                        <label for="select-exam">Ø§Ø®ØªØ± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                        <select id="select-exam">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù…ØªØ­Ø§Ù† --</option>
                        </select>
                    </div>
                    <button class="btn" id="start-exam-btn">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
                </div>
                
                <div id="exam-interface" style="display: none;">
                    <div class="exam-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
                        <h3 id="current-exam-title">Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h3>
                        <div class="timer" style="background: var(--accent-color); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">
                            Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="exam-timer">--:--</span>
                        </div>
                    </div>
                    
                    <div id="questions-list">
                        <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªØ¹Ø±Ø¶ Ù‡Ù†Ø§ -->
                    </div>
                    
                    <div class="exam-actions" style="display: flex; justify-content: space-between; margin-top: 2rem;">
                        <button class="btn" id="prev-question-btn" disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                        <button class="btn" id="next-question-btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        <button class="btn btn-danger" id="submit-exam-btn">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
                    </div>
                </div>
                
                <div id="exam-results" style="display: none;">
                    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ¹Ø±Ø¶ Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>

        <footer>
            <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2023 Zidan Test - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
        </footer>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyC0piIkOVmZpXpjBAG4DkvUj2-suzoiC0g",
            authDomain: "zidan-test-aad45.firebaseapp.com",
            projectId: "zidan-test-aad45",
            storageBucket: "zidan-test-aad45.firebasestorage.app",
            messagingSenderId: "1074752409914",
            appId: "1:1074752409914:web:4f235bbbf330bc74d4c003",
            measurementId: "G-ZD2P0EBFF7"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let exams = [];
        let currentExam = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval = null;
        let timeLeft = 0;

        // Ø¹Ù†Ø§ØµØ± DOM
        const homeSection = document.getElementById('home-section');
        const addExamSection = document.getElementById('add-exam-section');
        const examsSection = document.getElementById('exams-section');
        const takeExamSection = document.getElementById('take-exam-section');
        
        const examsCountElement = document.getElementById('exams-count');
        const questionsCountElement = document.getElementById('questions-count');
        const examsContainer = document.getElementById('exams-container');
        const questionsContainer = document.getElementById('questions-container');
        const selectExamElement = document.getElementById('select-exam');
        const examInterface = document.getElementById('exam-interface');
        const questionsList = document.getElementById('questions-list');

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙ†Ù‚Ù„
        document.getElementById('nav-home').addEventListener('click', showHome);
        document.getElementById('nav-exams').addEventListener('click', showExams);
        document.getElementById('nav-add-exam').addEventListener('click', showAddExam);
        document.getElementById('nav-take-exam').addEventListener('click', showTakeExam);

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('add-question-btn').addEventListener('click', addQuestion);
        document.getElementById('save-exam-btn').addEventListener('click', saveExam);
        document.getElementById('start-exam-btn').addEventListener('click', startExam);
        document.getElementById('prev-question-btn').addEventListener('click', prevQuestion);
        document.getElementById('next-question-btn').addEventListener('click', nextQuestion);
        document.getElementById('submit-exam-btn').addEventListener('click', submitExam);

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function showHome() {
            setActiveNav('nav-home');
            homeSection.style.display = 'block';
            addExamSection.style.display = 'none';
            examsSection.style.display = 'none';
            takeExamSection.style.display = 'none';
            loadStats();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
        function showExams() {
            setActiveNav('nav-exams');
            homeSection.style.display = 'none';
            addExamSection.style.display = 'none';
            examsSection.style.display = 'block';
            takeExamSection.style.display = 'none';
            loadExams();
        }

        // Ø¹Ø±Ø¶ Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù†
        function showAddExam() {
            setActiveNav('nav-add-exam');
            homeSection.style.display = 'none';
            addExamSection.style.display = 'block';
            examsSection.style.display = 'none';
            takeExamSection.style.display = 'none';
            questionsContainer.innerHTML = '';
            addQuestion(); // Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        }

        // Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function showTakeExam() {
            setActiveNav('nav-take-exam');
            homeSection.style.display = 'none';
            addExamSection.style.display = 'none';
            examsSection.style.display = 'none';
            takeExamSection.style.display = 'block';
            loadExamsForSelection();
        }

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ†Ø´ÙŠØ· ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function setActiveNav(navId) {
            document.querySelectorAll('nav a').forEach(nav => {
                nav.classList.remove('nav-active');
            });
            document.getElementById(navId).classList.add('nav-active');
        }

        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
        function addQuestion() {
            const questionId = Date.now();
            const questionHTML = `
                <div class="question-container" data-id="${questionId}">
                    <div class="question-header">
                        <h3>Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h3>
                        <button class="btn btn-danger remove-question-btn" type="button">Ø­Ø°Ù</button>
                    </div>
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                        <textarea class="question-text" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"></textarea>
                    </div>
                    <div class="options-container">
                        <div class="option-item">
                            <input type="radio" name="correct-${questionId}" value="0" checked>
                            <input type="text" class="option-text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„">
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct-${questionId}" value="1">
                            <input type="text" class="option-text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ">
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct-${questionId}" value="2">
                            <input type="text" class="option-text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«">
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct-${questionId}" value="3">
                            <input type="text" class="option-text" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹">
                        </div>
                    </div>
                </div>
            `;
            
            questionsContainer.insertAdjacentHTML('beforeend', questionHTML);
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„
            const removeBtn = questionsContainer.querySelector(`[data-id="${questionId}"] .remove-question-btn`);
            removeBtn.addEventListener('click', function() {
                if (questionsContainer.children.length > 1) {
                    this.closest('.question-container').remove();
                } else {
                    alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                }
            });
        }

        // Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙÙŠ Firebase
        async function saveExam() {
            const examName = document.getElementById('exam-name').value;
            const examDuration = document.getElementById('exam-duration').value;
            const examDescription = document.getElementById('exam-description').value;
            
            if (!examName || !examDuration) {
                showAlert('add-exam-alert', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const questions = [];
            const questionElements = questionsContainer.querySelectorAll('.question-container');
            
            for (const element of questionElements) {
                const questionText = element.querySelector('.question-text').value;
                const options = Array.from(element.querySelectorAll('.option-text')).map(input => input.value);
                const correctIndex = parseInt(element.querySelector('input[type="radio"]:checked').value);
                
                if (!questionText || options.some(opt => !opt.trim())) {
                    showAlert('add-exam-alert', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª', 'error');
                    return;
                }
                
                questions.push({
                    text: questionText,
                    options: options,
                    correct: correctIndex
                });
            }
            
            try {
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('exams').add({
                    name: examName,
                    duration: parseInt(examDuration),
                    description: examDescription,
                    questions: questions,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showAlert('add-exam-alert', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('exam-name').value = '';
                document.getElementById('exam-duration').value = '30';
                document.getElementById('exam-description').value = '';
                questionsContainer.innerHTML = '';
                addQuestion();
                
            } catch (error) {
                console.error('Error saving exam:', error);
                showAlert('add-exam-alert', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†', 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ù† Firebase
        async function loadExams() {
            try {
                const snapshot = await db.collection('exams').orderBy('createdAt', 'desc').get();
                exams = [];
                snapshot.forEach(doc => {
                    exams.push({ id: doc.id, ...doc.data() });
                });
                
                renderExams();
            } catch (error) {
                console.error('Error loading exams:', error);
                examsContainer.innerHTML = '<div class="alert alert-error">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</div>';
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function renderExams() {
            if (exams.length === 0) {
                examsContainer.innerHTML = '<div class="alert">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</div>';
                return;
            }
            
            examsContainer.innerHTML = '';
            exams.forEach(exam => {
                const examElement = document.createElement('div');
                examElement.className = 'exam-card';
                examElement.innerHTML = `
                    <h3>${exam.name}</h3>
                    <p>${exam.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${exam.duration} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${exam.questions.length}</p>
                    <div class="exam-actions">
                        <button class="btn" data-id="${exam.id}">Ø¹Ø±Ø¶</button>
                        <button class="btn btn-danger" data-id="${exam.id}">Ø­Ø°Ù</button>
                    </div>
                `;
                
                examsContainer.appendChild(examElement);
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                const viewBtn = examElement.querySelector('.btn:not(.btn-danger)');
                const deleteBtn = examElement.querySelector('.btn-danger');
                
                viewBtn.addEventListener('click', () => viewExam(exam.id));
                deleteBtn.addEventListener('click', () => deleteExam(exam.id));
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStats() {
            try {
                const snapshot = await db.collection('exams').get();
                const examsCount = snapshot.size;
                let questionsCount = 0;
                
                snapshot.forEach(doc => {
                    questionsCount += doc.data().questions.length;
                });
                
                examsCountElement.textContent = examsCount;
                questionsCountElement.textContent = questionsCount;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
        async function loadExamsForSelection() {
            try {
                const snapshot = await db.collection('exams').get();
                selectExamElement.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù…ØªØ­Ø§Ù† --</option>';
                
                snapshot.forEach(doc => {
                    const exam = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = exam.name;
                    selectExamElement.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading exams for selection:', error);
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        async function startExam() {
            const examId = selectExamElement.value;
            if (!examId) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù…ØªØ­Ø§Ù†');
                return;
            }
            
            try {
                const doc = await db.collection('exams').doc(examId).get();
                if (!doc.exists) {
                    alert('Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                currentExam = { id: doc.id, ...doc.data() };
                currentQuestionIndex = 0;
                userAnswers = new Array(currentExam.questions.length).fill(null);
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                document.getElementById('exam-selection').style.display = 'none';
                examInterface.style.display = 'block';
                document.getElementById('current-exam-title').textContent = currentExam.name;
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                timeLeft = currentExam.duration * 60;
                startTimer();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„
                renderQuestion();
                
            } catch (error) {
                console.error('Error starting exam:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†');
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitExam();
                }
            }, 1000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('exam-timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function renderQuestion() {
            const question = currentExam.questions[currentQuestionIndex];
            
            let optionsHTML = '';
            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestionIndex] === index;
                optionsHTML += `
                    <div class="option-item">
                        <input type="radio" name="answer" value="${index}" ${isSelected ? 'checked' : ''}>
                        <label>${option}</label>
                    </div>
                `;
            });
            
            questionsList.innerHTML = `
                <div class="question-container">
                    <div class="question-header">
                        <h3>Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestionIndex + 1} Ù…Ù† ${currentExam.questions.length}</h3>
                    </div>
                    <div class="form-group">
                        <p class="question-text">${question.text}</p>
                    </div>
                    <div class="options-container">
                        ${optionsHTML}
                    </div>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
            const radioButtons = questionsList.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    userAnswers[currentQuestionIndex] = parseInt(this.value);
                });
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            document.getElementById('prev-question-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-question-btn').disabled = 
                currentQuestionIndex === currentExam.questions.length - 1;
        }

        // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        function nextQuestion() {
            if (currentQuestionIndex < currentExam.questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function submitExam() {
            clearInterval(timerInterval);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let correctAnswers = 0;
            currentExam.questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctAnswers++;
                }
            });
            
            const totalQuestions = currentExam.questions.length;
            const score = correctAnswers;
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            examInterface.style.display = 'none';
            document.getElementById('exam-results').style.display = 'block';
            document.getElementById('exam-results').innerHTML = `
                <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
                <div style="text-align: center; margin: 2rem 0;">
                    <div style="font-size: 3rem; color: var(--primary-color); font-weight: bold;">
                        ${score}/${totalQuestions}
                    </div>
                    <div style="font-size: 1.5rem; margin: 1rem 0;">
                        Ø§Ù„Ù†Ø³Ø¨Ø©: ${percentage}%
                    </div>
                    <p style="color: #666; margin: 1rem 0;">
                        ${percentage >= 60 ? 'Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ù†Ø¬Ø­Øª ÙÙŠ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†' : 'Ø¢Ø³ÙØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø©'}
                    </p>
                </div>
                <button class="btn" onclick="showTakeExam()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</button>
            `;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function viewExam(examId) {
            const exam = exams.find(e => e.id === examId);
            if (!exam) return;
            
            let questionsHTML = '';
            exam.questions.forEach((q, index) => {
                questionsHTML += `
                    <div class="question-container">
                        <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${q.text}</h4>
                        <div class="options-container">
                            ${q.options.map((opt, i) => `
                                <div class="option-item ${i === q.correct ? 'selected' : ''}">
                                    ${i === q.correct ? 'âœ“ ' : ''}${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            examsContainer.innerHTML = `
                <div class="exam-card">
                    <button class="btn" onclick="showExams()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
                    <h2>${exam.name}</h2>
                    <p>${exam.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${exam.duration} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${exam.questions.length}</p>
                    <hr style="margin: 1.5rem 0;">
                    <h3>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†:</h3>
                    ${questionsHTML}
                </div>
            `;
        }

        // Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        async function deleteExam(examId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŸ')) return;
            
            try {
                await db.collection('exams').doc(examId).delete();
                loadExams(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                loadStats(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            } catch (error) {
                console.error('Error deleting exam:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function showAlert(containerId, message, type) {
            const alertContainer = document.getElementById(containerId);
            alertContainer.innerHTML = `
                <div class="alert ${type === 'success' ? 'alert-success' : 'alert-error'}">
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            showHome();
        });
    </script>
</body>
</html>
